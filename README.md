# üé´ Support System API - Prueba T√©cnica 2025

API RESTful para sistema de gesti√≥n de tickets de soporte t√©cnico, construida con Next.js 15, Prisma ORM y autenticaci√≥n JWT.

## üåê Despliegue en Producci√≥n

**URL de Producci√≥n (API, no posee interfaz):** [https://support-system-pt2025-api.vercel.app]

## üèóÔ∏è Arquitectura del Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        CLIENTE (React)                          ‚îÇ
‚îÇ              http://localhost:5173 (Desarrollo)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ HTTP/HTTPS + CORS
                            ‚îÇ JWT Token (Bearer/Cookie)
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    API REST (Next.js 15)                        ‚îÇ
‚îÇ                  http://localhost:3000/api                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Middleware & Helpers                                           ‚îÇ
‚îÇ  ‚îú‚îÄ CORS Configuration (/src/lib/cors.ts)                       ‚îÇ
‚îÇ  ‚îú‚îÄ JWT Verification (/src/lib/auth.ts)                         ‚îÇ
‚îÇ  ‚îî‚îÄ Prisma Client (/src/lib/prisma.ts)                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  API Routes (App Router)                                        ‚îÇ
‚îÇ  ‚îú‚îÄ /api/auth/*           ‚Üí Autenticaci√≥n                       ‚îÇ
‚îÇ  ‚îú‚îÄ /api/private/requests ‚Üí Gesti√≥n de Solicitudes              ‚îÇ
‚îÇ  ‚îú‚îÄ /api/private/responses ‚Üí Gesti√≥n de Respuestas              ‚îÇ
‚îÇ  ‚îú‚îÄ /api/private/me       ‚Üí Perfil de Usuario                   ‚îÇ
‚îÇ  ‚îî‚îÄ /api/private/admin/*  ‚Üí Administraci√≥n de Usuarios          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
                            ‚îÇ Prisma ORM
                            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Base de Datos (SQLite)                        ‚îÇ
‚îÇ                    /prisma/dev.db                               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Tablas:                                                        ‚îÇ
‚îÇ  ‚îú‚îÄ users      ‚Üí Usuarios del sistema                           ‚îÇ
‚îÇ  ‚îú‚îÄ requests   ‚Üí Solicitudes de soporte                         ‚îÇ
‚îÇ  ‚îî‚îÄ responses  ‚Üí Respuestas a solicitudes                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Roles de Usuario:
‚îú‚îÄ ADMIN    ‚Üí Acceso total al sistema
‚îú‚îÄ SUPPORT  ‚Üí Gesti√≥n de tickets y respuestas
‚îî‚îÄ CLIENT   ‚Üí Crear y ver sus propias solicitudes
```

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- **Node.js** >= 18.x
- De preferencia usar: **pnpm**

### Pasos de Instalaci√≥n

1. **Clonar el repositorio**

```bash
git clone <https://github.com/kevinguzman420/support-system-pt2025-api>
cd pt2025-api
```

2. **Instalar dependencias**

```bash
pnpm install
```

3. **Configurar variables de entorno**

Crear archivo `.env` en la ra√≠z del proyecto:

```env
# Database
DATABASE_URL="file:./dev.db"

# JWT Secret (cambiar en producci√≥n)
JWT_SECRET="your-super-secret-jwt-key-change-in-production"

# Node Environment
NODE_ENV="development"
```

4. **Generar Prisma Client**

```bash
npx prisma generate
```

5. **Ejecutar migraciones de base de datos**

```bash
npx prisma migrate dev --name init
```

6. **Poblar base de datos con datos de prueba (seed), aunque no es necesario**

```bash
npx prisma db seed
```

Este comando crear√° 3 usuarios de prueba:

| Email               | Password | Rol     | Activo |
| ------------------- | -------- | ------- | ------ |
| admin@example.com   | demo123  | ADMIN   | ‚úÖ     |
| support@example.com | demo123  | SUPPORT | ‚úÖ     |
| client@example.com  | demo123  | CLIENT  | ‚úÖ     |

7. **Iniciar el servidor de desarrollo**

```bash
pnpm dev
```

La API estar√° disponible en: **http://localhost:3000**

## üìã Endpoints Disponibles

### üîê Autenticaci√≥n

| M√©todo | Endpoint           | Descripci√≥n              | Autenticaci√≥n |
| ------ | ------------------ | ------------------------ | ------------- |
| `POST` | `/api/auth/login`  | Iniciar sesi√≥n           | ‚ùå            |
| `POST` | `/api/auth/logout` | Cerrar sesi√≥n            | ‚úÖ            |
| `GET`  | `/api/auth/login`  | Informaci√≥n del endpoint | ‚ùå            |

**Ejemplo Login:**

```json
POST /api/auth/login
{
  "email": "admin@example.com",
  "password": "demo123"
}

Respuesta:
{
  "message": "Login successful",
  "token": "eyJhbGciOiJIUzI1NiIs...",
  "user": {
    "id": "...",
    "email": "admin@example.com",
    "name": "Admin User",
    "role": "ADMIN",
    "createdAt": "...",
    "requestsCount": 0
  }
}
```

### üë§ Perfil de Usuario

| M√©todo | Endpoint          | Descripci√≥n                       | Roles |
| ------ | ----------------- | --------------------------------- | ----- |
| `GET`  | `/api/private/me` | Obtener datos del usuario actual  | Todos |
| `PUT`  | `/api/private/me` | Actualizar contrase√±a del usuario | Todos |

**Ejemplo Cambiar Contrase√±a:**

```json
PUT /api/private/me
Headers: { "Authorization": "Bearer <token>" }
{
  "newPassword": "nuevaContrase√±a123"
}
```

### üé´ Gesti√≥n de Solicitudes (Requests)

| M√©todo | Endpoint                | Descripci√≥n           | Roles   |
| ------ | ----------------------- | --------------------- | ------- |
| `GET`  | `/api/private/requests` | Listar solicitudes    | Todos\* |
| `POST` | `/api/private/requests` | Crear nueva solicitud | Todos   |

\*Los CLIENT solo ven sus propias solicitudes, ADMIN/SUPPORT ven todas.

**Ejemplo Crear Solicitud:**

```json
POST /api/private/requests
Headers: { "Authorization": "Bearer <token>" }
{
  "title": "Problema con el sistema",
  "description": "No puedo acceder a mi cuenta",
  "priority": "HIGH",
  "category": "ACCESS_ISSUE"
}

Valores permitidos:
- priority: "LOW" | "MEDIUM" | "HIGH" | "CRITICAL"
- category: "TECHNICAL_SUPPORT" | "GENERAL_INQUIRY" | "ACCESS_ISSUE" | "BILLING" | "OTHER"
- status: "PENDING" | "IN_PROGRESS" | "RESOLVED" | "CLOSED" (autom√°tico: PENDING)
```

### üí¨ Gesti√≥n de Respuestas (Responses)

| M√©todo | Endpoint                               | Descripci√≥n                            | Roles     |
| ------ | -------------------------------------- | -------------------------------------- | --------- |
| `GET`  | `/api/private/responses`               | Listar respuestas                      | Todos\*   |
| `GET`  | `/api/private/responses?requestId=xxx` | Respuestas de una solicitud espec√≠fica | Todos\*   |
| `POST` | `/api/private/responses`               | Crear respuesta                        | Todos\*\* |

\*Los CLIENT solo ven respuestas de sus propias solicitudes.  
\*\*Los CLIENT solo pueden responder a sus propias solicitudes.

**Ejemplo Crear Respuesta:**

```json
POST /api/private/responses
Headers: { "Authorization": "Bearer <token>" }
{
  "requestId": "clxxx...",
  "content": "Hemos revisado tu solicitud y...",
  "isAutomatic": false
}
```

### üë• Administraci√≥n de Usuarios (Solo ADMIN)

| M√©todo  | Endpoint                           | Descripci√≥n               | Roles |
| ------- | ---------------------------------- | ------------------------- | ----- |
| `GET`   | `/api/private/admin/users`         | Listar todos los usuarios | ADMIN |
| `POST`  | `/api/private/admin/users`         | Crear nuevo usuario       | ADMIN |
| `PATCH` | `/api/private/admin/users/:userId` | Actualizar usuario        | ADMIN |

**Ejemplo Crear Usuario:**

```json
POST /api/private/admin/users
Headers: { "Authorization": "Bearer <token>" }
{
  "email": "nuevo@example.com",
  "password": "password123",
  "name": "Nuevo Usuario",
  "role": "SUPPORT",
  "active": true
}

Roles permitidos: "ADMIN" | "SUPPORT" | "CLIENT"
```

**Ejemplo Actualizar Usuario:**

```json
PATCH /api/private/admin/users/clxxx...
Headers: { "Authorization": "Bearer <token>" }
{
  "name": "Nombre Actualizado",
  "role": "ADMIN",
  "active": false
}
```

## üîë Autenticaci√≥n

La API utiliza **JWT (JSON Web Tokens)** con estrategia dual:

1. **Cookie HttpOnly** (`token`) - Seguridad adicional
2. **Header Authorization** - `Authorization: Bearer <token>`

El token expira en **24 horas**.

### Ejemplo de petici√≥n autenticada:

```javascript
fetch('http://localhost:3000/api/private/requests', {
  method: 'GET',
  headers: {
    Authorization: 'Bearer eyJhbGciOiJIUzI1NiIs...',
    'Content-Type': 'application/json',
  },
  credentials: 'include', // Para cookies
})
```

## üóÉÔ∏è Modelo de Datos

### User (Usuario)

```typescript
{
  id: string
  email: string (√∫nico)
  password: string (hasheado con bcrypt)
  name: string
  role: "ADMIN" | "SUPPORT" | "CLIENT"
  active: boolean
  createdAt: DateTime
  updatedAt: DateTime
}
```

### Request (Solicitud)

```typescript
{
  id: string
  title: string
  description: string
  status: 'PENDING' | 'IN_PROGRESS' | 'RESOLVED' | 'CLOSED'
  priority: 'LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL'
  category: 'TECHNICAL_SUPPORT' |
    'GENERAL_INQUIRY' |
    'ACCESS_ISSUE' |
    'BILLING' |
    'OTHER'
  userId: string
  createdAt: DateTime
  updatedAt: DateTime
}
```

### Response (Respuesta)

```typescript
{
  id: string
  content: string
  isAutomatic: boolean
  requestId: string
  userId: string
  createdAt: DateTime
}
```

## üõ†Ô∏è Tecnolog√≠as Utilizadas

- **Next.js 15.5.5** - Framework React con App Router
- **Prisma ORM** - ORM moderno para TypeScript
- **SQLite** - Base de datos (desarrollo)
- **JWT (jsonwebtoken)** - Autenticaci√≥n
- **bcryptjs** - Hash de contrase√±as
- **TypeScript** - Tipado est√°tico
- **CORS** - Configuraci√≥n para peticiones cross-origin

## üìÅ Estructura del Proyecto

```
pt2025-api/
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma        # Modelo de datos
‚îÇ   ‚îú‚îÄ‚îÄ seed.ts              # Datos de prueba
‚îÇ   ‚îî‚îÄ‚îÄ dev.db               # Base de datos SQLite
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ auth/        # Endpoints de autenticaci√≥n
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ private/     # Endpoints protegidos
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ requests/   # Gesti√≥n de solicitudes
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ responses/  # Gesti√≥n de respuestas
‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ me/         # Perfil de usuario
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ admin/      # Administraci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ auth.ts          # Helper de autenticaci√≥n JWT
‚îÇ       ‚îú‚îÄ‚îÄ cors.ts          # Configuraci√≥n CORS
‚îÇ       ‚îî‚îÄ‚îÄ prisma.ts        # Cliente Prisma
‚îú‚îÄ‚îÄ .env                     # Variables de entorno
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üß™ Probar la API

### Con cURL

```bash
# Login
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"demo123"}'

# Crear solicitud (reemplazar <TOKEN>)
curl -X POST http://localhost:3000/api/private/requests \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <TOKEN>" \
  -d '{"title":"Test","description":"Prueba de API","priority":"MEDIUM"}'
```

### Con Postman/Insomnia

1. Importar colecci√≥n de endpoints
2. Configurar variable de entorno `baseURL`: `http://localhost:3000`
3. Login y copiar el `token` de la respuesta
4. Agregar header `Authorization: Bearer <token>` en peticiones protegidas

## üìä Base de Datos

### Ver datos con Prisma Studio

```bash
npx prisma studio
```

Se abrir√° en **http://localhost:5555** una interfaz visual para explorar la base de datos.

### Resetear base de datos

```bash
npx prisma migrate reset
npx prisma db seed
```

## üåç CORS

La API permite peticiones desde:

- `http://localhost:3000`
- `http://localhost:3001`
- `http://localhost:5173` (Vite)
- `http://localhost:4200` (Angular)
- Cualquier puerto localhost en desarrollo

## üìù Scripts Disponibles

```bash
pnpm dev          # Iniciar servidor de desarrollo
pnpm build        # Compilar para producci√≥n

npx prisma studio    # Abrir Prisma Studio
npx prisma generate  # Generar cliente Prisma
npx prisma migrate dev # Crear nueva migraci√≥n
npx prisma db seed   # Poblar base de datos
```

## üöÄ Despliegue en Vercel

Este proyecto est√° optimizado para desplegarse en Vercel:

1. Push del c√≥digo a GitHub
2. Conectar repositorio en [Vercel](https://vercel.com)
3. Configurar variables de entorno:
   - `DATABASE_URL`
   - `JWT_SECRET`
   - `NODE_ENV=production`
4. Deploy autom√°tico

**URL de producci√≥n:** [https://support-system-pt2025-api.vercel.app]

## üìÑ Licencia

Este proyecto fue desarrollado como prueba t√©cnica 2025 para CIFRA.

---

## üë• Autor

**Kevin Guzm√°n**
- Email: kevinjguzmano777@outlook.com
- GitHub: [@kevinguzman420](https://github.com/kevinguzman420)
- Deplegado en[Vercel](https://vercel.com) 

Desarrollado con ‚ù§Ô∏è por Kevin Guzm√°n (Powered by AI)
